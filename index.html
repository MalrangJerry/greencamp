<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=370, height=290, initial-scale=1" />
  <title>LOL Overlay</title>

  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

  <style>
    :root{
      --bg: rgba(18,18,20,.92);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.70);
      --win: #2ecc71;
      --loss:#e74c3c;
      --accent:#ffd54f;

      /* íŒ€ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸(3íŒ€ ì´ìƒ ëŒ€ë¹„) */
      --c1:#4aa8ff; /* blue */
      --c2:#ff4a7a; /* red/pink */
      --c3:#34d17b; /* green */
      --c4:#b084ff; /* purple */
      --c5:#ffb84a; /* orange */
      --c6:#57d7ff; /* cyan */
      --c7:#ff5ad6; /* magenta */
    }

    body{ margin:0; width:370px; height:290px; background:transparent; overflow:hidden; }

    .card{
      position:relative;
      width:370px; height:290px;
      box-sizing:border-box;
      padding:10px;
      background:var(--bg);
      border:1px solid var(--stroke);
      border-radius:0;
      color:var(--text);
      font-family:"Pretendard", system-ui, -apple-system, Segoe UI, sans-serif;
      overflow:hidden;
    }

    .timer{
      margin-top:0;
      text-align:center;
      font-weight:900;
      font-size:17px;
      letter-spacing:.6px;
      color:var(--accent);
      line-height:1.1;
    }

    /* âœ… ê³ ì • px ë§ê³  ìë™ ê³„ì‚°(ì˜ë¦¼ ë°©ì§€) */
    .views{
      position:relative;
      margin-top:8px;
      height: calc(100% - 26px - 8px); /* timer(ëŒ€ëµ) + margin */
    }

    .view{
      position:absolute; inset:0;
      opacity:0;
      transform: translateY(4px);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
    }
    .view.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    /* =========================
       ê³µí†µ: NíŒ€ ê·¸ë¦¬ë“œ
       ========================= */
    .grid{
      --cols: 2;
      display:grid;
      grid-template-columns: repeat(var(--cols), minmax(0, 1fr));
      gap:10px;
      height:100%;
    }
    .grid.cols-3{ gap:8px; }
    .grid.cols-4{ gap:6px; }

    /* âœ… 3íŒ€ì´ë©´ "ê°€ë¡œì¤„"(ì„¸ë¡œ 3í–‰, 1ì—´) */
    .grid.rows-3{
      grid-template-columns: 1fr !important;
      grid-auto-rows: 1fr;
      gap:8px;
    }

    .teamTile{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.02);
      padding:8px 8px 7px;
      box-sizing:border-box;
      min-width:0;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      overflow:hidden;
    }

    /* íŒ€ ì»¬ëŸ¬ */
    .t1{ color:var(--c1); }
    .t2{ color:var(--c2); }
    .t3{ color:var(--c3); }
    .t4{ color:var(--c4); }
    .t5{ color:var(--c5); }
    .t6{ color:var(--c6); }
    .t7{ color:var(--c7); }

    /* =========================
       SCORE VIEW
       ========================= */
    .scoreGrid{ height:100%; }

    .scoreTile{
      align-items:center;
      text-align:center;
      justify-content:flex-start;
    }
    .scoreName{
      font-weight:1000;
      font-size:14px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
      opacity:.95;
    }
    .scoreNum{
      margin-top:10px;
      font-weight:1000;
      font-size:56px;
      line-height:1;
      font-variant-numeric: tabular-nums;
    }

    /* 4íŒ€ ì´ìƒì´ë©´ í°íŠ¸ ìë™ ë‹¤ìš´(ì˜ë¦¼ ë°©ì§€) */
    .cols-4 .scoreName{ font-size:12px; }
    .cols-4 .scoreNum{ font-size:40px; margin-top:10px; }

    .scoreMini{
      width:100%;
      margin-top:10px;
      padding-top:8px;
      border-top:1px solid rgba(255,255,255,.10);
      font-size:12px;
      font-weight:900;
      line-height:1.25;
      opacity:.92;
    }
    .miniSum{
      display:flex;
      justify-content:center;
      gap:6px;
      font-variant-numeric: tabular-nums;
      opacity:.88;
    }

    /* âœ… 3íŒ€(ê°€ë¡œì¤„) ì „ìš©: íŒ€ëª…/ì ìˆ˜/ìš”ì•½ "ì—´ ì •ë ¬ ê³ ì •" + ë†’ì´ ì••ì¶• */
    .grid.rows-3.scoreGrid .teamTile{
      display:grid !important;
      grid-template-columns: 1fr 72px 150px; /* ì´ë¦„ | ì ìˆ˜ | ì˜¤ë¥¸ìª½ ìš”ì•½ */
      align-items:center;
      column-gap:10px;
      padding:6px 10px;
    }
    .grid.rows-3.scoreGrid .scoreName{
      text-align:left;
      font-size:14px;
      max-width:100%;
      margin:0;
    }
    .grid.rows-3.scoreGrid .scoreNum{
      margin:0 !important;
      font-size:44px;
      text-align:center;
    }
    .grid.rows-3.scoreGrid .scoreMini{
      width:auto !important;
      margin:0 !important;
      padding:0 !important;
      border:none !important;
    }
    .grid.rows-3.scoreGrid .miniSum{
      justify-content:flex-end;
      font-size:12px;
      opacity:.9;
      margin:0 !important;
      padding:0 !important;
      border:none !important;
    }

    /* =========================
       PLAYERS VIEW (2íŒ€/4íŒ€ ì´ìƒìš©)
       ========================= */
    .playersGrid{ height:100%; }

    .listHeader{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:8px;
      font-weight:1000;
      font-size:14px;
      letter-spacing:.2px;
      color:rgba(255,255,255,.75);
      margin-bottom:8px;
      min-width:0;
    }
    .listHeader .hn{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      min-width:0;
    }
    .listHeader .ht{
      white-space:nowrap;
      font-variant-numeric: tabular-nums;
    }

    .players{
      font-size:16px;
      font-weight:950;
      line-height:1.25;
      min-width:0;
    }

    /* âœ… í–‰ êµ¬ë¶„ì„  */
    .player{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      padding:7px 0;
      border-bottom:1px solid rgba(255,255,255,.10);
      opacity:.98;
      min-width:0;
    }
    .players .player:first-child{
      border-top:1px solid rgba(255,255,255,.10);
    }

    .pname{
      max-width:65%;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      min-width:0;
    }
    .pscore{
      font-variant-numeric: tabular-nums;
      white-space:nowrap;
      opacity:.95;
    }

    /* 6ëª… ì´ìƒì´ë©´ ê³¼ë°€ ë°©ì§€ */
    .dense .players{ font-size:14px; }
    .dense .player{ padding:6px 0; }
    .dense .listHeader{ margin-bottom:6px; }

    .sumLine{
      margin-top:10px;
      padding-top:8px;
      border-top:1px solid rgba(255,255,255,.10);
      font-weight:900;
      font-size:14px;
      letter-spacing:.25px;
      opacity:.78;
      display:flex;
      justify-content:center;
      font-variant-numeric: tabular-nums;
    }

    /* =========================
       FULLSCREEN MATCH ALERT
       ìŠ¹ë¦¬/íŒ¨ë°° -> ìŠ¤íŠ¸ë¦¬ë¨¸ -> KDA
       ========================= */
    .alert{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;

      background:rgba(0,0,0,.62);
      border-radius:0;
      opacity:0;
      pointer-events:none;
      transform: translateY(6px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .alert.show{
      opacity:1;
      pointer-events:auto;
      transform: translateY(0);
    }

    .alertResult{
      font-weight:1000;
      font-size:54px;
      line-height:1;
      letter-spacing:1px;
    }
    .alertResult.win{ color:var(--win); }
    .alertResult.loss{ color:var(--loss); }

    .alertStreamer{
      font-weight:1000;
      font-size:22px;
      letter-spacing:.2px;
      color:rgba(255,255,255,.92);
      max-width:340px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .alertKda{
      font-weight:900;
      font-size:16px;
      letter-spacing:.2px;
      color:rgba(255,255,255,.86);
      font-variant-numeric: tabular-nums;
    }
  </style>
</head>

<body>
  <div id="card" class="card">
    <div id="timer" class="timer">ë‚¨ì€ì‹œê°„ 00:00:00</div>

    <div class="views">
      <!-- SCORE VIEW -->
      <div id="viewScore" class="view active">
        <div id="scoreGrid" class="grid scoreGrid"></div>
      </div>

      <!-- PLAYERS VIEW -->
      <div id="viewPlayers" class="view">
        <div id="playersGrid" class="grid playersGrid"></div>
      </div>
    </div>

    <!-- MATCH END ì•Œë¦¼ -->
    <div id="alert" class="alert">
      <div id="alertResult" class="alertResult win">ìŠ¹ë¦¬</div>
      <div id="alertStreamer" class="alertStreamer">ìŠ¤íŠ¸ë¦¬ë¨¸</div>
      <div id="alertKda" class="alertKda">KDA 0/0/0</div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://nnvfzuwvhzsmrwddzhtm.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5udmZ6dXd2aHpzbXJ3ZGR6aHRtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNTE2NTgsImV4cCI6MjA4NjYyNzY1OH0.aZ_78os2YeL6vKKiQFDQnWDLGwZP7YMTsZ82iunm8wY";
    const LOBBY_ID = "lobby1";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // settings ìºì‹œ
    let lastSettings = null;

    // âœ… teams_json íŒ€ëª… override
    let teamNameOverride = {}; // {teamId: teamName}

    // âœ… í† ìŠ¤íŠ¸ì— í‘œì‹œí•  â€œí‘œì‹œ ë‹‰ë„¤ì„â€(payload.streamerName ìš°ì„ )
    let cachedStreamer = "ìŠ¤íŠ¸ë¦¬ë¨¸";

    // âœ… í˜„ì¬ íŒ€ ê°œìˆ˜(3íŒ€ì´ë©´ í™”ë©´ì „í™˜ ì—†ìŒ)
    window.__TEAM_COUNT__ = 2;

    // ğŸ”Š ì‘ì€ "ë»ë”" ì•Œë¦¼ìŒ (ìŠ¹/íŒ¨ ë™ì¼)
    let audioCtx = null;
    function playPop(){
      try{
        if(!audioCtx){
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if(audioCtx.state === "suspended"){
          audioCtx.resume().catch(()=>{});
        }

        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = "sine";
        osc.frequency.value = 520;

        const now = audioCtx.currentTime;
        gain.gain.setValueAtTime(0.0001, now);
        gain.gain.exponentialRampToValueAtTime(0.035, now + 0.008);
        gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc.start(now);
        osc.stop(now + 0.085);
      }catch(e){
        console.log("sound error", e);
      }
    }

    // ===== í™”ë©´ ì „í™˜ (10ì´ˆ / 10ì´ˆ) =====
    const viewScore = document.getElementById("viewScore");
    const viewPlayers = document.getElementById("viewPlayers");
    let mode = "SCORE";
    const PERIOD_MS = 10000;

    let rotator = null;
    function applyMode(){
      if(mode === "SCORE"){
        viewScore.classList.add("active");
        viewPlayers.classList.remove("active");
      }else{
        viewPlayers.classList.add("active");
        viewScore.classList.remove("active");
      }
    }

    function stopRotator(){
      if(rotator){
        clearInterval(rotator);
        rotator = null;
      }
    }

    function startRotator(){
      // âœ… 3íŒ€ì´ë©´ "í™”ë©´ì „í™˜ ì—†ìŒ"(ìŠ¤ì½”ì–´ í™”ë©´ ê³ ì •)
      if(window.__TEAM_COUNT__ === 3){
        mode = "SCORE";
        applyMode();
        stopRotator();
        return;
      }

      if(rotator) return;
      applyMode();
      rotator = setInterval(()=>{
        mode = (mode === "SCORE") ? "PLAYERS" : "SCORE";
        applyMode();
      }, PERIOD_MS);
    }

    startRotator();

    // ===== íƒ€ì´ë¨¸(ì¹´ìš´íŠ¸ë‹¤ìš´) =====
    function hhmmss(sec){
      sec = Math.max(0, Math.floor(sec));
      const h = String(Math.floor(sec/3600)).padStart(2,"0");
      const m = String(Math.floor((sec%3600)/60)).padStart(2,"0");
      const s = String(sec%60).padStart(2,"0");
      return `${h}:${m}:${s}`;
    }

    function computeCountdownText(){
      const status = lastSettings?.session_status ?? "IDLE";
      if(status !== "RUNNING") return "ë‚¨ì€ì‹œê°„ 00:00:00";

      const start = lastSettings?.session_start_ts ? Date.parse(lastSettings.session_start_ts) : null;
      if(!start) return "ë‚¨ì€ì‹œê°„ 00:00:00";

      const duration = Number(lastSettings?.duration_seconds ?? 10800);
      const elapsed = (Date.now() - start) / 1000;
      const remain = duration - elapsed;

      return "ë‚¨ì€ì‹œê°„ " + hhmmss(remain);
    }

    function renderTimer(){
      document.getElementById("timer").textContent = computeCountdownText();
    }
    setInterval(renderTimer, 1000);

    // ===== íŒ€ëª… ì„ íƒ =====
    function pickTeamName(teamId, fromPayload){
      const ov = teamNameOverride?.[teamId];
      if(ov && String(ov).trim()) return ov;
      return fromPayload || teamId || "TEAM";
    }

    // ===== NíŒ€ ë ˆì´ì•„ì›ƒ ê²°ì • =====
    function applyLayout(gridEl, n){
      // âœ… 3íŒ€ì´ë©´ "ê°€ë¡œì¤„"(ì„¸ë¡œ 3í–‰)
      const useRows3 = (n === 3);
      gridEl.classList.toggle("rows-3", useRows3);

      if(useRows3){
        gridEl.style.setProperty("--cols", "1");
        gridEl.classList.remove("cols-3", "cols-4");
        return;
      }

      // ê·¸ ì™¸ëŠ” 1~4ì—´
      const cols = Math.max(1, Math.min(n, 4));
      gridEl.style.setProperty("--cols", String(cols));
      gridEl.classList.toggle("cols-3", cols === 3);
      gridEl.classList.toggle("cols-4", cols === 4);
    }

    // XSS ë°©ì§€ìš©
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== ìƒíƒœ ë Œë” (SCORE + PLAYERS) =====
    function renderState(payload){
      if(!payload) return;

      cachedStreamer = payload.streamerName
        ?? lastSettings?.streamer_name
        ?? "ìŠ¤íŠ¸ë¦¬ë¨¸";

      const teamsObj = payload.teams || {};
      const teamEntries = Object.entries(teamsObj)
        .map(([id, t])=>({ id, ...(t||{}) }))
        .filter(t=>t && t.id);

      if(teamEntries.length === 0) return;

      // âœ… íŒ€ ê°œìˆ˜ ê°±ì‹ (3íŒ€ì´ë©´ ë¡œí…Œì´í„° ë”)
      window.__TEAM_COUNT__ = teamEntries.length;

      const scoreGrid = document.getElementById("scoreGrid");
      const playersGrid = document.getElementById("playersGrid");

      applyLayout(scoreGrid, teamEntries.length);
      applyLayout(playersGrid, teamEntries.length);

      // dense íŒë‹¨(ìµœëŒ€ ì¸ì› ê¸°ì¤€)
      const maxPlayers = Math.max(...teamEntries.map(t => (t.players?.length ?? 0)), 0);
      document.getElementById("card").classList.toggle("dense", maxPlayers >= 6);

      // ===== SCORE ë Œë” =====
      scoreGrid.innerHTML = "";
      teamEntries.forEach((t, idx)=>{
        const colorClass = `t${(idx % 7) + 1}`;
        const name = pickTeamName(t.id, t.name);
        const totalW = Number(t.total ?? 0);

        const playersArr = (t.players ?? []);
        const totalL = playersArr.reduce((acc, p)=> acc + (Number(p.l)||0), 0);

        scoreGrid.innerHTML += `
          <div class="teamTile scoreTile">
            <div class="scoreName ${colorClass}">${escapeHtml(name)}</div>
            <div class="scoreNum ${colorClass}">${totalW}</div>
            <div class="scoreMini">
              <div class="miniSum ${colorClass}">W ${totalW} / L ${totalL}</div>
            </div>
          </div>
        `;
      });

      // ===== PLAYERS ë Œë” =====
      playersGrid.innerHTML = "";
      teamEntries.forEach((t, idx)=>{
        const colorClass = `t${(idx % 7) + 1}`;
        const name = pickTeamName(t.id, t.name);
        const totalW = Number(t.total ?? 0);
        const playersArr = (t.players ?? []);
        const totalL = playersArr.reduce((acc, p)=> acc + (Number(p.l)||0), 0);

        const rows = playersArr.map(p=>{
          const pn = p?.name ?? "";
          const w = Number(p?.w ?? 0);
          const l = Number(p?.l ?? 0);
          return `
            <div class="player">
              <span class="pname">${escapeHtml(pn)}</span>
              <span class="pscore">${w}ìŠ¹ ${l}íŒ¨</span>
            </div>
          `;
        }).join("");

        playersGrid.innerHTML += `
          <div class="teamTile">
            <div class="listHeader">
              <span class="hn ${colorClass}">${escapeHtml(name)}</span>
              <span class="ht ${colorClass}">${totalW}</span>
            </div>

            <div class="players">
              ${rows || `<div style="opacity:.7; padding:8px 0;">-</div>`}
            </div>

            <div class="sumLine ${colorClass}">W ${totalW} / L ${totalL}</div>
          </div>
        `;
      });

      // âœ… 3íŒ€ì´ë©´ SCORE í™”ë©´ ê³ ì • + ì „í™˜ ì¤‘ì§€
      if(teamEntries.length === 3){
        mode = "SCORE";
        applyMode();
        stopRotator();
      }else{
        // 3íŒ€ì´ ì•„ë‹ˆë©´ ì „í™˜ ë™ì‘ ìœ ì§€(êº¼ì ¸ìˆìœ¼ë©´ ë‹¤ì‹œ ì¼œê¸°)
        startRotator();
      }
    }

    // ===== ì „ì²´í™”ë©´ ì•Œë¦¼(MATCH_END) =====
    const ALERT_MS = 6000;
    let alertTimer = null;

function showAlert(ev){
  const alert = document.getElementById("alert");
  const aResult = document.getElementById("alertResult");
  const aStreamer = document.getElementById("alertStreamer");
  const aKda = document.getElementById("alertKda");

  const isWin = ev.result === "WIN";
  aResult.textContent = isWin ? "ìŠ¹ë¦¬" : "íŒ¨ë°°";
  aResult.className = "alertResult " + (isWin ? "win" : "loss");

  // âœ… í† ìŠ¤íŠ¸ì— í‘œì‹œí•  ì´ë¦„ ìš°ì„ ìˆœìœ„:
  // 1) ì´ë²¤íŠ¸ payloadì— streamerName ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©
  // 2) ì—†ìœ¼ë©´ ì´ë²¤íŠ¸ payloadì˜ playerName(= í‘œì‹œ ë‹‰ë„¤ì„) ì‚¬ìš©  â† ë„¤ê°€ ì›í•œ ê¸°ì¤€
  // 3) ì—†ìœ¼ë©´ settingsì˜ streamer_name
  // 4) ìµœí›„ ê¸°ë³¸ê°’
  const nameForToast =
    (ev.streamerName && String(ev.streamerName).trim())
      ? ev.streamerName
      : (ev.playerName && String(ev.playerName).trim())
        ? ev.playerName
        : (lastSettings?.streamer_name && String(lastSettings.streamer_name).trim())
          ? lastSettings.streamer_name
          : "ìŠ¤íŠ¸ë¦¬ë¨¸";

  aStreamer.textContent = nameForToast;

  aKda.textContent = ev.kda ? `KDA ${ev.kda}` : "KDA -/-/-";

  playPop();

  stopRotator();
  alert.classList.add("show");

  clearTimeout(alertTimer);
  alertTimer = setTimeout(()=>{
    alert.classList.remove("show");
    startRotator();
  }, ALERT_MS);
}

    // ===== settings/state fetch =====
    async function fetchSettings(){
      const { data } = await supabase
        .from("lobby_settings")
        .select("*")
        .eq("lobby_id", LOBBY_ID)
        .maybeSingle();

      lastSettings = data ?? null;

      // teams_json íŒŒì‹±(ìˆìœ¼ë©´ override)
      teamNameOverride = {};
      try{
        const raw = lastSettings?.teams_json;
        const arr = (typeof raw === "string") ? JSON.parse(raw) : raw;
        if(Array.isArray(arr)){
          for(const t of arr){
            if(t?.id) teamNameOverride[t.id] = t?.name ?? null;
          }
        }
      }catch(e){}

      renderTimer();
    }

    async function fetchState(){
      const { data } = await supabase
        .from("overlay_state")
        .select("payload")
        .eq("lobby_id", LOBBY_ID)
        .maybeSingle();

      if(data?.payload) renderState(data.payload);
    }

    // ===== init =====
    await fetchSettings();
    await fetchState();

    setInterval(fetchSettings, 5000);
    setInterval(fetchState, 5000);

    // realtime
    supabase.channel("settings")
      .on("postgres_changes", {
        event: "*", schema: "public", table: "lobby_settings",
        filter: `lobby_id=eq.${LOBBY_ID}`
      }, (e)=>{
        lastSettings = e.new ?? null;

        teamNameOverride = {};
        try{
          const raw = lastSettings?.teams_json;
          const arr = (typeof raw === "string") ? JSON.parse(raw) : raw;
          if(Array.isArray(arr)){
            for(const t of arr){
              if(t?.id) teamNameOverride[t.id] = t?.name ?? null;
            }
          }
        }catch(_){}

        renderTimer();
      })
      .subscribe();

    supabase.channel("state")
      .on("postgres_changes", {
        event: "*", schema: "public", table: "overlay_state",
        filter: `lobby_id=eq.${LOBBY_ID}`
      }, (e)=>{
        if(e.new?.payload) renderState(e.new.payload);
      })
      .subscribe();

    supabase.channel("events")
      .on("postgres_changes", {
        event: "INSERT", schema: "public", table: "overlay_events",
        filter: `lobby_id=eq.${LOBBY_ID}`
      }, (e)=>{
        if(e.new?.type === "MATCH_END"){
          showAlert(e.new.payload);
        }
      })
      .subscribe();
  </script>
</body>
</html>
